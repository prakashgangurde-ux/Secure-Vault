<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Vault - Ephemeral Data Storage</title>
    <meta name="description" content="SecureVault — ephemeral encrypted notes & files. Store secrets that self-destruct after 1–72 hours.">
    <meta name="theme-color" content="#020617">
    <link rel="icon" href="favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest" defer></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        body {
            background-color: #020617; /* slate-950 */
            color: #f8fafc; /* slate-50 */
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .hidden { display: none !important; }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; opacity: 0; }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .text-gradient {
            background: linear-gradient(to right, #60a5fa, #c084fc, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col relative selection:bg-blue-500/30 selection:text-blue-200">

    <!-- Notify if JS is disabled -->
    <noscript>
        <div class="fixed inset-0 z-50 bg-red-900 text-white flex items-center justify-center p-4">
            <p class="max-w-xl text-center">This application requires JavaScript to run. Please enable JavaScript in your browser.</p>
        </div>
    </noscript>

    <!-- LOADING SCREEN -->
    <div id="loading-screen" class="fixed inset-0 bg-slate-950 z-50 flex flex-col items-center justify-center" role="status" aria-live="polite">
        <div class="relative">
            <div class="absolute inset-0 bg-blue-500 blur-xl opacity-20 rounded-full"></div>
            <i data-lucide="shield" class="w-16 h-16 text-blue-500 animate-pulse relative z-10" aria-hidden="true"></i>
        </div>
        <p class="text-slate-400 mt-6 font-light tracking-widest uppercase text-sm">Initializing Secure Core</p>
        <p id="config-status" class="text-slate-600 text-xs mt-2 font-mono" aria-live="polite">Verifying protocols...</p>
    </div>

    <!-- LANDING PAGE (Welcome Screen) -->
    <div id="landing-screen" class="hidden flex-col min-h-screen">
        <!-- Navbar -->
        <nav class="w-full py-6 px-4 md:px-8 flex justify-between items-center max-w-7xl mx-auto w-full">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600/20 p-2 rounded-lg border border-blue-500/20">
                    <i data-lucide="shield" class="text-blue-400 w-6 h-6"></i>
                </div>
                <span class="font-bold text-xl tracking-tight">SecureVault</span>
            </div>
            <button id="nav-login-btn" class="px-5 py-2 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-700 text-sm font-medium transition-all hover:border-slate-600">
                Log In
            </button>
        </nav>

        <!-- Hero Section -->
        <header class="flex-1 flex flex-col items-center justify-center text-center px-4 py-20 max-w-5xl mx-auto">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-300 text-xs font-medium mb-8 animate-fade-in">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                </span>
                Military-Grade Encryption Active
            </div>
            
            <h1 class="text-5xl md:text-7xl font-extrabold tracking-tight mb-6 animate-fade-in delay-100 leading-tight">
                Share Secrets that <br>
                <span class="text-gradient">Self-Destruct.</span>
            </h1>
            
            <p class="text-lg md:text-xl text-slate-400 max-w-2xl mb-10 animate-fade-in delay-200 leading-relaxed">
                The secure way to send temporary passwords, private keys, and sensitive files. 
                Data is encrypted, stored for 24-72 hours, and then permanently erased.
            </p>
            
            <div class="flex flex-col sm:flex-row gap-4 animate-fade-in delay-300">
                <button id="hero-cta-btn" class="group relative px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-[0_0_40px_-10px_rgba(37,99,235,0.5)] transition-all hover:scale-105 flex items-center gap-2 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-700"></div>
                    <span>Start Vaulting Now</span>
                    <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                </button>
                <button id="learn-more-btn" class="px-8 py-4 bg-slate-900/50 hover:bg-slate-800 border border-slate-700 text-slate-200 font-semibold rounded-xl transition-all">
                    How it Works
                </button>
            </div>
        </header>

        <!-- Feature Grid -->
        <section id="features" class="py-20 px-4 max-w-7xl mx-auto w-full">
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Card 1 -->
                <div class="glass-panel p-8 rounded-2xl hover:border-blue-500/30 transition-colors group">
                    <div class="w-12 h-12 bg-blue-500/10 rounded-xl flex items-center justify-center mb-6 group-hover:bg-blue-500/20 transition-colors">
                        <i data-lucide="timer" class="text-blue-400 w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Auto-Delete</h3>
                    <p class="text-slate-400 leading-relaxed">
                        Set a timer for 24, 48, or 72 hours. Once the time is up, our servers physically overwrite and delete your data.
                    </p>
                </div>
                <!-- Card 2 -->
                <div class="glass-panel p-8 rounded-2xl hover:border-purple-500/30 transition-colors group">
                    <div class="w-12 h-12 bg-purple-500/10 rounded-xl flex items-center justify-center mb-6 group-hover:bg-purple-500/20 transition-colors">
                        <i data-lucide="lock" class="text-purple-400 w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">AES-256 Security</h3>
                    <p class="text-slate-400 leading-relaxed">
                        Your data is secured by Firebase Auth rules and industry-standard encryption at rest and in transit.
                    </p>
                </div>
                <!-- Card 3 -->
                <div class="glass-panel p-8 rounded-2xl hover:border-pink-500/30 transition-colors group">
                    <div class="w-12 h-12 bg-pink-500/10 rounded-xl flex items-center justify-center mb-6 group-hover:bg-pink-500/20 transition-colors">
                        <i data-lucide="file-check" class="text-pink-400 w-6 h-6"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-white">Free Tier Limits</h3>
                    <p class="text-slate-400 leading-relaxed">
                        To keep this service free, we enforce a 5MB limit per file and a 50MB total vault size per user.
                    </p>
                </div>
            </div>
        </section>

        <!-- FEEDBACK & COMMUNITY SECTION -->
        <section class="py-12 border-t border-slate-800/50 bg-slate-900/30 relative overflow-hidden">
            <!-- Background glow -->
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl pointer-events-none"></div>
            
            <div class="max-w-4xl mx-auto px-4 text-center relative z-10">
                <h3 class="text-2xl font-bold text-white mb-3">Join the SecureVault Community</h3>
                <p class="text-slate-400 mb-8 max-w-lg mx-auto">
                    We are building this in the open. Have a feature request, found a bug, or just want to chat? We'd love to hear from you.
                </p>
                
                <div class="flex flex-wrap justify-center gap-4">
                    <!-- Discord Button -->
                    <a href="https://discord.gg/wcCsZ6x9" target="_blank" rel="noopener noreferrer" class="group flex items-center gap-3 px-5 py-3 bg-[#5865F2]/10 text-[#5865F2] hover:bg-[#5865F2] hover:text-white border border-[#5865F2]/20 rounded-xl transition-all hover:scale-105 hover:shadow-lg hover:shadow-[#5865F2]/20">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                        <span class="font-semibold">Join Discord</span>
                    </a>
                    
                    <!-- GitHub Button
                    <a href="https://github.com/your-username/securevault" target="_blank" rel="noopener noreferrer" class="group flex items-center gap-3 px-5 py-3 bg-slate-800 text-slate-300 hover:bg-slate-700 hover:text-white border border-slate-700 rounded-xl transition-all hover:scale-105 hover:shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
                        <span class="font-semibold">Star on GitHub</span>
                    </a> -->

                    <!-- Email Button -->
                    <a href="mailto:feedback@securevault.app" class="group flex items-center gap-3 px-5 py-3 bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500 hover:text-white border border-emerald-500/20 rounded-xl transition-all hover:scale-105 hover:shadow-lg hover:shadow-emerald-500/20">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                        <span class="font-semibold">Send Feedback</span>
                    </a>
                </div>
            </div>
        </section>
        
        <footer class="py-10 text-center border-t border-slate-800 bg-slate-950 relative z-10">
            <div class="flex flex-col items-center gap-3">
                <div class="flex items-center gap-2 text-blue-500/80 bg-blue-500/5 px-3 py-1 rounded-full border border-blue-500/10">
                    <i data-lucide="shield-check" class="w-4 h-4"></i>
                    <span class="text-xs font-semibold tracking-wide uppercase">Zero-Knowledge Architecture</span>
                </div>
                <p class="text-slate-500 text-sm mt-2">
                    &copy; 2025 SecureVault Inc. All logs are disabled by design.
                </p>
            </div>
        </footer>
    </div>

    <!-- AUTH SCREEN (Login/Signup) -->
    <div id="auth-screen" class="hidden min-h-screen flex items-center justify-center p-4 relative">
        <!-- Back Button -->
        <button id="back-to-landing" class="absolute top-6 left-6 text-slate-400 hover:text-white flex items-center gap-2 transition-colors">
            <i data-lucide="arrow-left" class="w-4 h-4"></i> Back
        </button>

        <div class="w-full max-w-md glass-panel rounded-2xl shadow-2xl p-8 border border-slate-700/50">
            <div class="flex justify-center mb-6">
                <div class="bg-blue-600/20 p-4 rounded-full border border-blue-500/20 shadow-[0_0_15px_rgba(37,99,235,0.3)]">
                    <i data-lucide="fingerprint" class="text-blue-400 w-8 h-8"></i>
                </div>
            </div>
            <h1 class="text-2xl font-bold text-center mb-2 text-white">Vault Access</h1>
            <p class="text-center text-slate-400 mb-8 text-sm">Enter your credentials to decrypt your space.</p>

            <div id="auth-error" class="hidden bg-red-500/10 border border-red-500/50 text-red-400 p-3 rounded-lg mb-4 text-sm text-center"></div>

            <form id="auth-form" class="space-y-4">
                <div>
                    <label class="block text-xs font-medium mb-1.5 text-slate-400 uppercase tracking-wider">Email Address</label>
                    <div class="relative">
                        <i data-lucide="mail" class="absolute left-3 top-2.5 w-4 h-4 text-slate-500"></i>
                        <input type="email" id="auth-email" required class="w-full bg-slate-950/50 border border-slate-700 rounded-lg py-2.5 pl-10 pr-3 text-white focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 outline-none transition-all placeholder:text-slate-600" placeholder="name@example.com">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-medium mb-1.5 text-slate-400 uppercase tracking-wider">Password</label>
                    <div class="relative">
                        <i data-lucide="key" class="absolute left-3 top-2.5 w-4 h-4 text-slate-500"></i>
                        <input type="password" id="auth-password" required minlength="6" class="w-full bg-slate-950/50 border border-slate-700 rounded-lg py-2.5 pl-10 pr-3 text-white focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 outline-none transition-all placeholder:text-slate-600" placeholder="••••••••">
                    </div>
                </div>
                <button type="submit" id="auth-submit-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg hover:shadow-blue-500/20 mt-2">
                    Unlock Vault
                </button>
            </form>

            <div class="mt-6 text-center pt-6 border-t border-slate-700/50">
                <button id="toggle-auth-mode" class="text-slate-400 hover:text-white text-sm transition-colors">
                    Don't have a vault? <span class="text-blue-400 hover:underline">Create one</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN APP DASHBOARD -->
    <div id="app-screen" class="hidden flex-1 flex flex-col" role="application" aria-label="SecureVault application">
        <!-- Header -->
        <header class="glass-panel border-b border-slate-700/50 p-4 sticky top-0 z-10">
            <div class="max-w-5xl mx-auto flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="bg-blue-600/20 p-1.5 rounded border border-blue-500/20">
                        <i data-lucide="shield" class="text-blue-400 w-5 h-5"></i>
                    </div>
                    <span class="font-bold text-lg tracking-tight text-white">SecureVault</span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden sm:flex flex-col items-end">
                        <span class="text-[10px] text-slate-400 uppercase tracking-wider">Logged in as</span>
                        <span id="user-email-display" class="text-sm text-white font-medium"></span>
                    </div>
                    <button id="logout-btn" class="group flex items-center gap-2 text-sm bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 hover:border-red-500/40 px-4 py-2 rounded-lg transition-all text-red-400">
                        <i data-lucide="log-out" class="w-4 h-4 group-hover:-translate-x-0.5 transition-transform"></i> 
                        <span>Exit</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="max-w-5xl mx-auto w-full p-4 space-y-8 py-8">
            
            <!-- Storage Usage Meter -->
            <section class="glass-panel rounded-2xl p-4 border border-slate-700/50 flex items-center gap-4">
                <div class="bg-slate-800 p-2 rounded-lg">
                    <i data-lucide="hard-drive" class="w-5 h-5 text-blue-400"></i>
                </div>
                <div class="flex-1">
                    <div class="flex justify-between text-xs font-medium mb-2">
                        <span class="text-slate-300">Vault Storage</span>
                        <span id="storage-text" class="text-slate-400">Checking usage...</span>
                    </div>
                    <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
                        <div id="storage-bar" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                <div class="hidden md:block text-right text-[10px] text-slate-500 uppercase font-bold">
                    Limit: 50MB
                </div>
            </section>

            <!-- Create Section -->
            <section class="glass-panel rounded-2xl p-6 md:p-8 shadow-2xl relative overflow-hidden">
                <!-- Decorative glow -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/5 rounded-full blur-3xl pointer-events-none translate-x-1/2 -translate-y-1/2"></div>

                <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-white relative z-10">
                    <i data-lucide="plus-circle" class="text-blue-400 w-5 h-5"></i> 
                    Deposit New Secret
                </h2>

                <!-- Tabs -->
                <div class="flex p-1 bg-slate-950/50 rounded-xl mb-6 w-full md:w-fit border border-slate-800/50 relative z-10">
                    <button id="tab-text" class="px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 bg-blue-600 text-white shadow-lg">
                        <i data-lucide="file-text" class="w-4 h-4"></i> Note
                    </button>
                    <button id="tab-file" class="px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-400 hover:text-white hover:bg-white/5">
                        <i data-lucide="upload" class="w-4 h-4"></i> File
                    </button>
                </div>

                <form id="create-form" class="space-y-6 relative z-10">
                    <!-- Text Input -->
                    <div id="input-container-text">
                        <textarea id="secret-text" placeholder="Enter your secret message, password, or API key here..." class="w-full h-40 bg-slate-950/50 border border-slate-700 rounded-xl p-4 text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none resize-none font-mono text-sm transition-all placeholder:text-slate-600"></textarea>
                    </div>

                    <!-- File Input -->
                    <div id="input-container-file" class="hidden">
                        <div class="border-2 border-dashed border-slate-700 rounded-xl p-12 text-center hover:bg-slate-900/50 hover:border-blue-500/50 transition-all cursor-pointer relative group">
                            <input type="file" id="secret-file" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20">
                            <div class="flex flex-col items-center relative z-10 pointer-events-none">
                                <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                                    <i data-lucide="cloud-upload" class="w-8 h-8 text-blue-400"></i>
                                </div>
                                <p id="file-name-display" class="text-slate-200 font-medium text-lg">Drop your file here</p>
                                <p class="text-slate-500 text-sm mt-1">Max file size: 5MB</p>
                            </div>
                        </div>
                    </div>

                    <!-- Duration Slider -->
                    <div class="bg-slate-900/30 rounded-xl p-4 border border-slate-800">
                        <div class="flex justify-between text-sm mb-3 text-slate-400">
                            <span class="flex items-center gap-2"><i data-lucide="bomb" class="w-4 h-4"></i> Self-destruct timer:</span>
                            <span id="duration-display" class="text-blue-400 font-bold bg-blue-500/10 px-2 py-0.5 rounded border border-blue-500/20">24 Hours</span>
                        </div>
                        <input type="range" id="duration-slider" min="1" max="72" step="1" value="24" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                        <div class="flex justify-between text-[10px] text-slate-600 mt-2 uppercase tracking-wider font-bold">
                            <span>1 hr</span>
                            <span>3 days</span>
                        </div>
                    </div>

                    <div id="upload-error" class="hidden bg-red-500/10 text-red-400 p-3 rounded-lg text-sm text-center border border-red-500/20"></div>

                    <button type="submit" id="submit-secret-btn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/20 transform transition-all active:scale-[0.99] flex items-center justify-center gap-2 group">
                        <i data-lucide="lock" class="w-5 h-5 group-hover:rotate-12 transition-transform"></i> 
                        <span>Encrypt & Store in Vault</span>
                    </button>
                </form>
            </section>

            <!-- List Section -->
            <section>
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold flex items-center gap-2 text-white">
                        <i data-lucide="database" class="text-green-400 w-5 h-5"></i> 
                        Active Secrets
                    </h2>
                    <span class="bg-slate-800 text-slate-400 text-xs font-bold px-3 py-1 rounded-full border border-slate-700">
                        <span id="items-count">0</span> Items
                    </span>
                </div>
                
                <div id="vault-grid" class="grid gap-6 md:grid-cols-2">
                    <!-- Items will be injected here via JS -->
                </div>

                <div id="empty-state" class="hidden text-center py-16 bg-slate-900/20 rounded-2xl border border-slate-800 border-dashed">
                    <div class="bg-slate-800/50 inline-block p-6 rounded-full mb-4">
                        <i data-lucide="ghost" class="text-slate-600 w-10 h-10"></i>
                    </div>
                    <p class="text-slate-400 text-lg font-medium">Your vault is empty</p>
                    <p class="text-slate-600 text-sm mt-1">Secrets you create will appear here until they expire.</p>
                </div>
            </section>
        </main>
    </div>

    <!-- FIREBASE MODULE LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            signInWithCustomToken,
            signInAnonymously
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            onSnapshot, 
            deleteDoc, 
            doc, 
            orderBy 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL, 
            deleteObject 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- CONSTANTS ---
        const MAX_FILE_SIZE_MB = 5;
        const MAX_TOTAL_STORAGE_MB = 50;
        const BYTES_IN_MB = 1024 * 1024;

        // --- GLOBAL STATE ---
        let app, auth, db, storage;
        let currentUser = null;
        let authMode = 'login'; // 'login' or 'signup'
        let currentType = 'text'; // 'text' or 'file'
        let selectedFile = null;
        let unsubscribeItems = null;
        let currentTotalStorageBytes = 0;

        // --- INIT ---
        async function init() {
            try {
                let config = null;
                const statusEl = document.getElementById('config-status');

                // --- ATTEMPT 1: Load from local firebaseConfig.js ---
                try {
                    const module = await import('./firebaseConfig.js');
                    if (module && module.firebaseConfig) {
                        config = module.firebaseConfig;
                        console.log("Loaded config from firebaseConfig.js");
                    }
                } catch (e) {
                    // Normal fallback
                }

                // --- ATTEMPT 2: Load from Environment (Preview Fallback) ---
                if (!config && typeof __firebase_config !== 'undefined') {
                    config = JSON.parse(__firebase_config);
                }

                // --- CHECK RESULT ---
                if (!config) {
                    statusEl.innerHTML = "<span class='text-red-400'>Error: Config missing.</span>";
                    throw new Error("Configuration not found.");
                }

                // Initialize Firebase
                app = initializeApp(config);
                auth = getAuth(app);
                db = getFirestore(app);
                storage = getStorage(app);

                // Auth Listener
                onAuthStateChanged(auth, (user) => {
                    currentUser = user;
                    renderScreens(); // Main routing logic
                    if (user) {
                        initDataListener(user.uid);
                    } else {
                        if (unsubscribeItems) unsubscribeItems();
                        document.getElementById('vault-grid').innerHTML = '';
                        currentTotalStorageBytes = 0;
                    }
                });

                // Check for custom token
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                }

                document.getElementById('loading-screen').classList.add('hidden');
                lucide.createIcons();

            } catch (e) {
                console.error("Init failed", e);
                const statusEl = document.getElementById('config-status');
                if (!statusEl.innerHTML.includes("Error")) {
                     document.getElementById('loading-screen').innerHTML += `<p class='text-red-500 mt-4'>Error initializing app: ${e.message}</p>`;
                }
            }
        }

        // --- ROUTING / UI STATE LOGIC ---
        function renderScreens() {
            const landingScreen = document.getElementById('landing-screen');
            const authScreen = document.getElementById('auth-screen');
            const appScreen = document.getElementById('app-screen');
            const userEmailDisplay = document.getElementById('user-email-display');

            // Reset all first
            landingScreen.classList.add('hidden');
            authScreen.classList.add('hidden');
            appScreen.classList.add('hidden');

            if (currentUser) {
                // Logged in -> Show App
                appScreen.classList.remove('hidden');
                userEmailDisplay.textContent = currentUser.email;
            } else {
                // Not logged in -> Show Landing Page
                landingScreen.classList.remove('hidden');
            }
        }

        function showAuthScreen() {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('auth-screen').classList.remove('hidden');
        }
        
        function showLandingScreen() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('landing-screen').classList.remove('hidden');
        }

        // --- DATA LISTENER & STORAGE CALCULATION ---
        function initDataListener(userId) {
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';
            // Use an ordered query so UI receives items sorted by creation time.
            const itemsCol = collection(db, 'artifacts', appId, 'users', userId, 'vault_items');
            const q = query(itemsCol, orderBy('createdAt', 'desc'));

            unsubscribeItems = onSnapshot(q, (snapshot) => {
                const items = [];
                const now = Date.now();
                currentTotalStorageBytes = 0; // Reset calculation

                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Filter locally for expiration
                    if (data.expireAt > now) {
                        items.push({ id: doc.id, ...data });
                        // Sum up storage (default to 0 if field missing)
                        if (data.fileSize) {
                            currentTotalStorageBytes += data.fileSize;
                        }
                    }
                });

                // Data already ordered by createdAt desc from the query
                renderItems(items);
                updateStorageMeter(); // Update UI
            }, (error) => {
                console.error("Data listen error:", error);
            });
        }

        function updateStorageMeter() {
            const usedMB = currentTotalStorageBytes / BYTES_IN_MB;
            const pct = Math.min(100, (usedMB / MAX_TOTAL_STORAGE_MB) * 100);
            
            const bar = document.getElementById('storage-bar');
            const text = document.getElementById('storage-text');
            
            bar.style.width = `${pct}%`;
            text.textContent = `${usedMB.toFixed(2)} MB / ${MAX_TOTAL_STORAGE_MB} MB`;
            
            // Color changes based on usage
            if (pct > 90) {
                bar.className = "h-full bg-red-500 transition-all duration-500";
            } else if (pct > 70) {
                bar.className = "h-full bg-orange-500 transition-all duration-500";
            } else {
                bar.className = "h-full bg-blue-500 transition-all duration-500";
            }
        }

        // --- RENDER ITEMS ---
        function renderItems(items) {
            const grid = document.getElementById('vault-grid');
            const countSpan = document.getElementById('items-count');
            const emptyState = document.getElementById('empty-state');

            countSpan.textContent = items.length;
            grid.innerHTML = '';

            if (items.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                items.forEach(item => {
                    const card = createItemCard(item);
                    grid.appendChild(card);
                });
            }
            lucide.createIcons();
        }

        function createItemCard(item) {
            const div = document.createElement('div');
            div.className = "glass-panel rounded-xl p-6 hover:border-blue-500/30 transition-all shadow-lg group relative overflow-hidden flex flex-col";
            
            const now = Date.now();
            const totalDuration = item.durationHours * 60 * 60 * 1000;
            const remaining = item.expireAt - now;
            const pct = Math.max(0, Math.min(100, (remaining / totalDuration) * 100));
            
            const hoursLeft = Math.floor(remaining / (1000 * 60 * 60));
            const minsLeft = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const timeStr = remaining <= 0 ? "Expired" : `${hoursLeft}h ${minsLeft}m left`;

            const iconType = item.type === 'text' ? 'file-text' : 'image';
            const iconColor = item.type === 'text' ? 'text-blue-400' : 'text-purple-400';
            const typeLabel = item.type === 'text' ? 'Secure Note' : 'Secret File';
            
            // Display file size if available
            const sizeDisplay = item.fileSize 
                ? `<span class="text-[10px] text-slate-500 bg-slate-800 px-2 py-0.5 rounded ml-2">${(item.fileSize / 1024 / 1024).toFixed(2)} MB</span>`
                : '';

            let contentHtml = '';
            if (item.type === 'text') {
                contentHtml = `<div class="bg-slate-950/50 p-4 rounded-lg border border-slate-800 text-slate-300 text-sm font-mono mb-4 h-24 overflow-y-auto break-all shadow-inner">${escapeHtml(item.content)}</div>`;
            } else {
                contentHtml = `
                    <div class="bg-slate-950/50 p-4 rounded-lg border border-slate-800 text-slate-300 text-sm font-mono mb-4 flex items-center gap-3 h-24 shadow-inner">
                        <div class="bg-slate-800 p-2 rounded">
                            <i data-lucide="file" class="w-5 h-5 text-slate-400"></i>
                        </div>
                        <span class="truncate font-semibold">${escapeHtml(item.content)}</span>
                    </div>`;
            }

            let viewBtn = '';
            if (item.type === 'file') {
                viewBtn = `
                    <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="flex-1 bg-slate-800 hover:bg-slate-700 text-white text-center text-sm py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2 font-medium border border-slate-700">
                        <i data-lucide="eye" class="w-4 h-4"></i> View
                    </a>`;
            }

            div.innerHTML = `
                <div class="absolute top-0 left-0 w-full h-1 bg-slate-800/50">
                    <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]" style="width: ${pct}%"></div>
                </div>
                <div class="flex justify-between items-start mb-4 mt-2">
                    <div class="flex items-center gap-3">
                        <div class="p-2 rounded-lg bg-slate-800 border border-slate-700">
                            <i data-lucide="${iconType}" class="${iconColor} w-5 h-5"></i>
                        </div>
                        <div>
                            <div class="flex items-center">
                                <h4 class="font-semibold text-white text-sm">${typeLabel}</h4>
                                ${sizeDisplay}
                            </div>
                            <span class="text-xs text-slate-500">AES-256 Encrypted</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-1.5 text-orange-400 text-xs font-mono bg-orange-500/10 px-2.5 py-1 rounded border border-orange-500/20">
                        <i data-lucide="clock" class="w-3 h-3"></i> ${timeStr}
                    </div>
                </div>
                ${contentHtml}
                <div class="flex gap-3 mt-auto">
                    ${viewBtn}
                    <button class="delete-btn flex-1 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20 hover:border-red-500/40 text-sm py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2 font-medium">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> Destroy
                    </button>
                </div>
            `;

            div.querySelector('.delete-btn').addEventListener('click', () => handleDelete(item));
            return div;
        }

        async function handleDelete(item) {
            if(!confirm("WARNING: This will permanently destroy this key. Proceed?")) return;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';

            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'users', currentUser.uid, 'vault_items', item.id));
                if (item.storagePath) {
                    const fileRef = ref(storage, item.storagePath);
                    await deleteObject(fileRef).catch(e => console.log("File already gone", e));
                }
            } catch (err) {
                alert("Error deleting: " + err.message);
            }
        }

        // --- EVENT LISTENERS ---

        document.getElementById('nav-login-btn').addEventListener('click', showAuthScreen);
        document.getElementById('hero-cta-btn').addEventListener('click', showAuthScreen);
        document.getElementById('back-to-landing').addEventListener('click', showLandingScreen);
        
        document.getElementById('learn-more-btn').addEventListener('click', () => {
            document.getElementById('features').scrollIntoView({ behavior: 'smooth' });
        });

        document.getElementById('toggle-auth-mode').addEventListener('click', (e) => {
            e.preventDefault();
            const btn = e.target.closest('button');
            const submitBtn = document.getElementById('auth-submit-btn');
            const title = document.querySelector('#auth-screen h1');
            
            if (authMode === 'login') {
                authMode = 'signup';
                btn.innerHTML = 'Already have a vault? <span class="text-blue-400 hover:underline">Login</span>';
                submitBtn.textContent = "Create New Vault";
                title.textContent = "Create Account";
            } else {
                authMode = 'login';
                btn.innerHTML = 'Don\'t have a vault? <span class="text-blue-400 hover:underline">Create one</span>';
                submitBtn.textContent = "Unlock Vault";
                title.textContent = "Vault Access";
            }
        });

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-password').value;
            const errDiv = document.getElementById('auth-error');
            const submitBtn = document.getElementById('auth-submit-btn');

            errDiv.classList.add('hidden');
            submitBtn.textContent = "Decrypting...";
            submitBtn.disabled = true;

            try {
                if (authMode === 'signup') {
                    await createUserWithEmailAndPassword(auth, email, pass);
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
            } catch (err) {
                errDiv.textContent = "Access Denied: " + err.message;
                errDiv.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.textContent = authMode === 'login' ? "Unlock Vault" : "Create New Vault";
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            signOut(auth);
        });

        document.getElementById('tab-text').addEventListener('click', (e) => { e.preventDefault(); setTab('text'); });
        document.getElementById('tab-file').addEventListener('click', (e) => { e.preventDefault(); setTab('file'); });

        function setTab(type) {
            currentType = type;
            const tText = document.getElementById('tab-text');
            const tFile = document.getElementById('tab-file');
            const cText = document.getElementById('input-container-text');
            const cFile = document.getElementById('input-container-file');

            if (type === 'text') {
                tText.className = "px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 bg-blue-600 text-white shadow-lg";
                tFile.className = "px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-400 hover:text-white hover:bg-white/5";
                cText.classList.remove('hidden');
                cFile.classList.add('hidden');
            } else {
                tFile.className = "px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 bg-blue-600 text-white shadow-lg";
                tText.className = "px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-slate-400 hover:text-white hover:bg-white/5";
                cFile.classList.remove('hidden');
                cText.classList.add('hidden');
            }
        }

        // File Selection & Validation
        document.getElementById('secret-file').addEventListener('change', (e) => {
            const fileInput = e.target;
            if (fileInput.files.length > 0) {
                const f = fileInput.files[0];
                
                // 5MB Limit Check
                if (f.size > MAX_FILE_SIZE_MB * BYTES_IN_MB) {
                    alert(`File is too large! Limit is ${MAX_FILE_SIZE_MB}MB.`);
                    fileInput.value = ''; // Reset
                    selectedFile = null;
                    document.getElementById('file-name-display').textContent = "Drop your file here";
                    return;
                }

                selectedFile = f;
                document.getElementById('file-name-display').textContent = f.name;
                e.target.parentElement.classList.add('border-blue-500', 'bg-blue-500/10');
            }
        });

        const slider = document.getElementById('duration-slider');
        const durDisplay = document.getElementById('duration-display');
        slider.addEventListener('input', (e) => {
            durDisplay.textContent = e.target.value + " Hours";
        });

        document.getElementById('create-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const textContent = document.getElementById('secret-text').value;
            const submitBtn = document.getElementById('submit-secret-btn');
            const errDiv = document.getElementById('upload-error');
            const duration = parseInt(slider.value);

            if (currentType === 'text' && !textContent.trim()) return;
            if (currentType === 'file' && !selectedFile) return;

            // Total Storage Limit Check
            if (currentType === 'file' && selectedFile) {
                const potentialTotal = currentTotalStorageBytes + selectedFile.size;
                const limitBytes = MAX_TOTAL_STORAGE_MB * BYTES_IN_MB;
                
                if (potentialTotal > limitBytes) {
                    errDiv.textContent = `Storage Limit Exceeded! You have ${((limitBytes - currentTotalStorageBytes)/1024/1024).toFixed(2)}MB remaining.`;
                    errDiv.classList.remove('hidden');
                    return;
                }
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = `<i data-lucide="loader" class="w-5 h-5 animate-spin"></i> Encrypting...`;
            errDiv.classList.add('hidden');

            try {
                const now = new Date();
                const expireTime = new Date(now.getTime() + duration * 60 * 60 * 1000);
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';
                
                let fileUrl = null;
                let filePath = null;
                let sizeInBytes = 0;

                if (currentType === 'file' && selectedFile) {
                    const storageRef = ref(storage, `users/${currentUser.uid}/${Date.now()}_${selectedFile.name}`);
                    const snapshot = await uploadBytes(storageRef, selectedFile);
                    fileUrl = await getDownloadURL(snapshot.ref);
                    filePath = snapshot.ref.fullPath;
                    sizeInBytes = selectedFile.size;
                }

                await addDoc(collection(db, 'artifacts', appId, 'users', currentUser.uid, 'vault_items'), {
                    type: currentType,
                    content: currentType === 'text' ? textContent : selectedFile.name,
                    url: fileUrl || null,
                    storagePath: filePath || null,
                    fileSize: sizeInBytes, // Save size to metadata
                    createdAt: now.getTime(),
                    expireAt: expireTime.getTime(),
                    ttlDate: expireTime,
                    durationHours: duration
                });

                // Reset
                document.getElementById('secret-text').value = '';
                document.getElementById('secret-file').value = '';
                selectedFile = null;
                document.getElementById('file-name-display').textContent = "Drop your file here";
                document.querySelector('#input-container-file > div').classList.remove('border-blue-500', 'bg-blue-500/10');

            } catch (err) {
                console.error(err);
                errDiv.textContent = "Error: " + err.message;
                errDiv.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = `<i data-lucide="lock" class="w-5 h-5 group-hover:rotate-12 transition-transform"></i> <span>Encrypt & Store in Vault</span>`;
                lucide.createIcons();
            }
        });

        function escapeHtml(text) {
            if (!text) return "";
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        init();
    </script>
</body>
</html>